<!DOCTYPE html>
<html>
  <head>
    <title>Mi sitio de pelÃ­culas</title>
    <link rel="stylesheet" href="css/index.css">
    <script>
        
    
    var ruta = "http://localhost:8080/PlayflixShow/imagenes/";
    
    const ajax = new XMLHttpRequest();
    
    function llamada(){
    	ajax.open("GET", "Puntuacion", true);
    	ajax.onreadystatechange = dameResponse;
    	ajax.send();
    }
    
    function dameResponse(){
    	if(ajax.readyState == 4){
    		if(ajax.status == 200){
    			let miPunt = "<p> La Puntuacion de la pelicula segun lus usuarios es: " + ajax.responseText + "</p>";
    			document.getElementById("puntuacion").innerHTML = miPunt; 
    		}
    	}
    }
    
    function obtenerPeliculas() {
 		
 		let nombre = document.getElementById("nombre").value;

     	fetch("BuscarPelicula?nombrePelicula="+nombre)
         	.then(res => res.json())
         	.then(res => pintarPeli(res));
 	}
	
    function pintarPeli(datos){
    	
    	let codigoHTML = "";
    	
    	codigoHTML += "<img src='imagenes/"+datos.imagenPeliculas+"'>";
    	

        document.getElementById("Peliculas").innerHTML = codigoHTML;  
        
        llamada();

    }

        function pintarDato(datos){

            let listaSaludos = "";

                listaSaludos += "<p>" + datos.nombre + "</p>";

            document.getElementById("nombreUsuario").innerHTML = listaSaludos;

        }
        
        function pintar(datos){

            let codigoHTML = "";

            for(var i=0;i<datos.length;i++){
                codigoHTML += "<img src='imagenes/"+datos[i].imagenPeliculas+"'>";
            }

            document.getElementById('Peliculas').innerHTML = codigoHTML;
        }
			
        window.onload = function(){
        	
            fetch('Listado')
                .then(res => res.json())
                .then(res => pintarDato(res));
            
             fetch('Peliculas')
            	.then(res => res.json())
            	.then(res => pintar(res));
             

            
            document.getElementById("cerrarSesion").addEventListener("click", function() {
               
                var ajax = new XMLHttpRequest();
                ajax.open("GET", "CerrarSesion", true);
                ajax.send();
                
                window.location.href = "index.html";
              });
        
            
        
         }
        </script>
  </head>
  <body>
    <header>
      <h1>PlayflixShow</h1>
    </header>
    <nav>
      <ul>
        <li><a href="paginaInicio.html">Inicio</a></li>
        <li><a href="peliculas.html">Peliculas</a></li>
        <li><a href="OpcionesUser.html">Comentarios</a></li>
        <input type="text" name="nombre" id="nombre" placeholder="Buscar peliculas...">
        <button onclick="obtenerPeliculas()">Buscar</button>
		
		<li id="cerrarSesion" class="cerrarSesion"><a id="cerrarSesion" href="#">Cerrar sesion</a></li>

      </ul>
    </nav>
    <section>
      <p id="nombreUsuario" class="usuario"><span id="usuario"></span></p>
	  <h2>Peliculas</h2>
	  <p id="puntuacion"> </p>
	  <div class="imagenes-peliculas" id='Peliculas'>
	  </div>
    </section>
    <footer>
      <p>© 2023 PlayflixShow. Todos los derechos reservados.</p>
      <p id="usuario"></p>
    </footer>
    <script src="script.js"></script>
  </body>
</html>
